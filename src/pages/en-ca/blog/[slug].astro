---
import { renderRichText, useStoryblokApi } from "@storyblok/astro";
import BlogPage from "@components/pages/blog/post.astro";
import { enCA } from "strings/routing";

export async function getStaticPaths() {
  const sbApi = useStoryblokApi();

  const { data } = await sbApi.get("cdn/stories", {
    content_type: "blogPost",
    version: import.meta.env.DEV ? "draft" : "published",
    starts_with: enCA,
  });

  return data.stories.map((sbStory) => {
    return {
      params: { slug: sbStory.slug },
      props: { sbStory },
    };
  });
}

const { sbStory } = Astro.props;
const { slug } = Astro.params;
const blogPost = sbStory.content;

const content = renderRichText(blogPost.content);
---

<BlogPage blogPost={sbStory.content} slug={slug} />
